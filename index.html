<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prem S — Enhanced Portfolio (Fixed)</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Poppins',sans-serif;overflow-x:hidden;background:#0a0a0a;color:#fff;scroll-behavior:smooth}

    /* Enhanced Canvases */
    #backgroundCanvas{position:fixed;inset:0;z-index:-3;background:radial-gradient(circle at 50% 50%, #0a0a0a 0%, #000 100%)}
    #cursorCanvas{position:fixed;inset:0;z-index:1000;pointer-events:none}
    #threeCanvas{position:fixed;inset:0;z-index:-2;pointer-events:none}

    /* Enhanced Layout with glass morphism */
    nav{
      position:fixed;top:0;left:0;width:100%;display:flex;justify-content:center;gap:20px;padding:18px 14px;
      background:rgba(0,0,0,.85);backdrop-filter:blur(15px);border-bottom:1px solid rgba(0,255,255,.2);z-index:100;
      box-shadow:0 8px 32px rgba(0,255,255,.1)
    }
    nav a{
      color:#fff;text-decoration:none;font-weight:500;transition:all .3s ease;position:relative;padding:8px 16px;border-radius:8px
    }
    nav a:hover{
      color:#0ff;text-shadow:0 0 15px #0ff;background:rgba(0,255,255,.1);transform:translateY(-2px)
    }
    nav a::before{
      content:'';position:absolute;inset:0;background:linear-gradient(45deg,rgba(0,255,255,.2),rgba(142,45,226,.2));
      border-radius:8px;opacity:0;transition:opacity .3s ease;z-index:-1
    }
    nav a:hover::before{opacity:1}

    /* Enhanced sections with improved glass effect */
    section{
      min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:56px 24px 64px;text-align:center;position:relative;z-index:1;margin:88px auto 24px;
      border-radius:20px;background:rgba(0,0,0,.7);backdrop-filter:blur(20px);
      border:1px solid rgba(0,255,255,.2);max-width:1200px;
      box-shadow:0 20px 40px rgba(0,255,255,.1), inset 0 1px 0 rgba(255,255,255,.1)
    }
    section::before{
      content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,255,255,.03),rgba(142,45,226,.03));
      border-radius:20px;pointer-events:none
    }

    h1,h2,h3{
      margin-bottom:14px;color:#0ff;text-shadow:0 0 25px rgba(0,255,255,.8);
      background:linear-gradient(45deg,#0ff,#8e2de2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;
      background-clip:text
    }
    p{max-width:780px;margin:0 auto 14px;line-height:1.6;color:#e0e0e0}

    /* Enhanced Buttons with 3D effects */
    .btn{
      display:inline-block;margin:10px;padding:12px 24px;border-radius:15px;text-decoration:none;
      font-weight:600;transition:all .4s ease;position:relative;overflow:hidden;
      transform-style:preserve-3d
    }
    .btn::before{
      content:'';position:absolute;inset:0;background:linear-gradient(45deg,rgba(255,255,255,.1),rgba(255,255,255,.05));
      transition:all .4s ease;z-index:-1
    }
    .btn-view{background:linear-gradient(45deg,#0ff,#00d4ff);color:#000;box-shadow:0 0 20px rgba(0,255,255,.4)}
    .btn-download{background:linear-gradient(45deg,#8e2de2,#c233ff);color:#fff;box-shadow:0 0 20px rgba(142,45,226,.4)}
    .btn:hover{
      transform:translateY(-4px) rotateX(10deg) scale(1.05);
      box-shadow:0 15px 35px rgba(0,255,255,.6), 0 0 25px rgba(142,45,226,.4)
    }
    .btn:hover::before{background:linear-gradient(45deg,rgba(255,255,255,.2),rgba(255,255,255,.1))}

    /* Enhanced Grids & Cards with advanced 3D effects */
    .projects-grid,.certs-grid,.internships-grid,.achievements-grid{
      display:grid;grid-template-columns:1fr;gap:32px;width:100%;margin-top:32px
    }
    @media(min-width:768px){
      .projects-grid,.certs-grid,.internships-grid,.achievements-grid{grid-template-columns:1fr 1fr}
    }

    .project-card,.internship-card,.achievement-item,.cert-item{
      background:rgba(255,255,255,.12);padding:28px;border-radius:20px;
      border:1px solid rgba(0,255,255,.15);transform-style:preserve-3d;
      transition:all .5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow:0 10px 30px rgba(0,255,255,.2), inset 0 1px 0 rgba(255,255,255,.1);
      position:relative;overflow:hidden
    }
    
    .project-card::before,.internship-card::before,.achievement-item::before{
      content:'';position:absolute;inset:0;
      background:linear-gradient(135deg,rgba(0,255,255,.05),rgba(142,45,226,.05));
      transition:all .5s ease;opacity:0
    }
    
    .project-card:hover,.internship-card:hover,.achievement-item:hover{
      transform:translateY(-15px) rotateX(8deg) rotateY(8deg) scale(1.05);
      box-shadow:0 25px 50px rgba(0,255,255,.7), 0 0 30px rgba(142,45,226,.8);
      border-color:rgba(0,255,255,.4)
    }
    .project-card:hover::before,.internship-card:hover::before,.achievement-item:hover::before{opacity:1}

    .cert-item{
      display:flex;align-items:center;justify-content:center;cursor:pointer;color:#0ff;
      text-decoration:underline;min-height:120px;
      background:linear-gradient(135deg,rgba(0,255,255,.1),rgba(142,45,226,.1))
    }
    .cert-item:hover{
      transform:translateY(-8px) scale(1.03);
      box-shadow:0 20px 40px rgba(0,255,255,.5);
      background:linear-gradient(135deg,rgba(0,255,255,.2),rgba(142,45,226,.2))
    }

    .internship-link,.achievement-link,.project-link{
      color:#0ff;text-decoration:underline;cursor:pointer;transition:all .3s ease
    }
    .internship-link:hover,.achievement-link:hover,.project-link:hover{
      color:#00ffff;text-shadow:0 0 10px #0ff;transform:translateY(-1px)
    }

    /* Enhanced About section */
    .about-content{display:flex;flex-direction:column;align-items:center;gap:32px;max-width:900px}
    .about-image{
      width:220px;height:220px;border-radius:50%;object-fit:cover;
      border:4px solid #0ff;box-shadow:0 0 30px rgba(0,255,255,.6);
      transition:all .5s ease;position:relative
    }
    .about-image:hover{
      transform:scale(1.08) rotateY(10deg);
      box-shadow:0 0 40px rgba(0,255,255,.9), 0 0 80px rgba(142,45,226,.4)
    }
    @media(min-width:768px){.about-content{flex-direction:row;text-align:left}.about-text{margin-left:32px}}

    /* Enhanced Skills — Fixed centered 3D word cloud */
    .skills-wrap{
      width:100%;max-width:1000px;height:600px;position:relative;perspective:1500px;
      overflow:hidden;display:flex;align-items:center;justify-content:center
    }
    .skills-cloud{
      position:relative;width:500px;height:500px;transform-style:preserve-3d;
      transition:transform .2s ease-out
    }
    .skill{
      position:absolute;left:50%;top:50%;transform-style:preserve-3d;display:inline-flex;align-items:center;
      justify-content:center;padding:12px 20px;border-radius:15px;
      border:1px solid rgba(0,255,255,.2);
      background:linear-gradient(135deg,rgba(255,255,255,.15),rgba(255,255,255,.05));
      box-shadow:0 8px 25px rgba(0,255,255,.2);cursor:pointer;user-select:none;
      white-space:nowrap;transition:all .4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      backdrop-filter:blur(10px);margin-left:-50px;margin-top:-20px
    }
    .skill:hover{
      transform:translate(-50%, -50%) translateZ(30px) scale(1.15);
      background:linear-gradient(135deg,rgba(0,255,255,.25),rgba(142,45,226,.15));
      box-shadow:0 15px 40px rgba(0,255,255,.8), 0 0 30px rgba(142,45,226,.6);
      border-color:rgba(0,255,255,.5)
    }
    .skill .label{font-weight:600;color:#fff}
    .skill .desc{
      position:absolute;top:110%;left:50%;transform:translateX(-50%) translateY(10px);
      min-width:260px;max-width:300px;pointer-events:none;opacity:0;visibility:hidden;
      background:rgba(0,0,0,.95);border:1px solid #0ff;border-radius:12px;
      padding:12px;font-size:13px;line-height:1.4;
      box-shadow:0 0 25px rgba(0,255,255,.5);
      transition:all .3s cubic-bezier(0.175, 0.885, 0.32, 1.275);z-index:10;
      backdrop-filter:blur(15px)
    }
    .skill:hover .desc,.skill.pinned .desc{
      opacity:1;visibility:visible;transform:translateX(-50%) translateY(0)
    }
    .skill.pinned{
      background:linear-gradient(135deg,rgba(0,255,255,.3),rgba(142,45,226,.2));
      box-shadow:0 0 35px rgba(0,255,255,.9)
    }

    /* Enhanced Modal with better effects */
    .modal{
      display:none;position:fixed;inset:0;z-index:1000;
      background:rgba(0,0,0,.95);align-items:center;justify-content:center;
      backdrop-filter:blur(10px)
    }
    .modal-content-container{
      max-height:90vh;display:flex;flex-direction:column;align-items:center;
      justify-content:center;animation:modalAppear .4s ease
    }
    @keyframes modalAppear{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
    .modal-content-container img,.modal-content-container iframe,.modal-content-container video{
      max-width:90%;max-height:90vh;border-radius:15px;box-shadow:0 20px 60px rgba(0,255,255,.3)
    }
    .close{
      position:absolute;top:20px;right:32px;font-size:42px;color:#fff;cursor:pointer;
      transition:all .3s ease
    }
    .close:hover{color:#0ff;text-shadow:0 0 15px #0ff;transform:scale(1.2)}

    /* Enhanced Resume iframe */
    iframe{
      width:85%;height:78vh;border:none;border-radius:15px;margin-top:20px;
      box-shadow:0 20px 40px rgba(0,255,255,.2)
    }

    /* Enhanced form styles */
    form{display:flex;flex-direction:column;gap:16px;width:100%}
    form input,form textarea{
      padding:12px 16px;border-radius:10px;border:1px solid rgba(0,255,255,.3);
      background:rgba(255,255,255,.1);color:#fff;font-family:inherit;
      transition:all .3s ease;backdrop-filter:blur(10px)
    }
    form input:focus,form textarea:focus{
      outline:none;border-color:#0ff;box-shadow:0 0 15px rgba(0,255,255,.4);
      background:rgba(255,255,255,.15)
    }
    form input::placeholder,form textarea::placeholder{color:rgba(255,255,255,.6)}

    /* Enhanced floating particles animation */
    .floating-particle{
      position:absolute;width:4px;height:4px;background:#0ff;border-radius:50%;
      animation:float 20s infinite linear;opacity:0.6;
      box-shadow:0 0 10px #0ff
    }
    @keyframes float{
      0%{transform:translateY(100vh) rotate(0deg);opacity:0}
      10%{opacity:0.8}
      90%{opacity:0.8}
      100%{transform:translateY(-100vh) rotate(360deg);opacity:0}
    }

    /* Glowing text effect */
    .glow-text{
      animation:textGlow 2s ease-in-out infinite alternate;
    }
    @keyframes textGlow{
      from{text-shadow:0 0 20px rgba(0,255,255,.5)}
      to{text-shadow:0 0 30px rgba(0,255,255,.8), 0 0 40px rgba(142,45,226,.4)}
    }

    /* Enhanced cursor effects */
    .cursor-particle{
      position:absolute;
      width:8px;
      height:8px;
      border-radius:50%;
      pointer-events:none;
      z-index:9999;
    }

    .glitter-particle{
      position:absolute;
      width:4px;
      height:4px;
      background:linear-gradient(45deg, #0ff, #fff, #8e2de2);
      border-radius:50%;
      pointer-events:none;
      z-index:9999;
      animation:glitterTwinkle 1s ease-out forwards;
    }

    @keyframes glitterTwinkle{
      0%{
        opacity:1;
        transform:scale(1) rotate(0deg);
        box-shadow:0 0 10px currentColor;
      }
      100%{
        opacity:0;
        transform:scale(0.3) rotate(180deg);
        box-shadow:0 0 20px transparent;
      }
    }
  </style>
</head>
<body>
  <canvas id="backgroundCanvas"></canvas>
  <canvas id="cursorCanvas"></canvas>
  <div id="threeCanvas"></div>

  <nav>
    <a href="#intro"><i class="fas fa-home"></i> Home</a>
    <a href="#about"><i class="fas fa-user"></i> About</a>
    <a href="#projects"><i class="fas fa-code"></i> Projects</a>
    <a href="#skills"><i class="fas fa-cogs"></i> Skills</a>
    <a href="#certs"><i class="fas fa-certificate"></i> Certifications</a>
    <a href="#internships"><i class="fas fa-briefcase"></i> Internships</a>
    <a href="#achievements"><i class="fas fa-trophy"></i> Achievements</a>
    <a href="#contact"><i class="fas fa-envelope"></i> Contact</a>
    <a href="#resume"><i class="fas fa-file-pdf"></i> Resume</a>
  </nav>

  <!-- INTRO -->
  <section id="intro" class="intro">
    <h1 class="glow-text">Hi, I'm Prem 👋</h1>
    <h3>Software Developer · Full-Stack · IoT & Cloud</h3>
    <p>Turning visionary ideas into scalable applications, intelligent IoT systems, and cutting-edge AI projects.</p>
    <div>
      <a href="kisame.pdf" target="_blank" class="btn btn-view"><i class="fas fa-eye"></i> View Resume</a>
      <a href="kisame.pdf" download class="btn btn-download"><i class="fas fa-download"></i> Download Resume</a>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="about">
    <h2>About Me</h2>
    <div class="about-content">
      <img src="prem.jpg" alt="Prem S" class="about-image">
      <div class="about-text">
        <p>3rd-year BE CSE student building robust full-stack apps and innovative IoT systems. Comfortable deploying scalable, resilient solutions on AWS.</p>
        <p>I love translating complex problems into elegant code and usable systems that have real impact.</p>
      </div>
    </div>
  </section>

  <!-- PROJECTS -->
  <section id="projects" class="projects">
    <h2>My Projects</h2>
    <div class="projects-grid">
      <div class="project-card">
        <h3><i class="fas fa-traffic-light"></i> Smart AI-Based Traffic Management</h3>
        <p>IoT system using thermal & humidity-aware vision to dynamically manage traffic lights and reduce congestion.</p>
        <p><a class="project-link" onclick="openModal('traffic managemnet proto.jpeg','image')"><i class="fas fa-eye"></i> View Prototype</a></p>
      </div>
      <div class="project-card">
        <h3><i class="fas fa-ship"></i> Kutty Port — Zepto of Export Logistics</h3>
        <p>Platform to streamline exports for MSMEs via decentralized, trackable logistics.</p>
        <p><a class="project-link" onclick="openModal('kutty port.pptx','pptx')"><i class="fas fa-eye"></i> View Details</a></p>
      </div>
      <div class="project-card">
        <h3><i class="fas fa-ambulance"></i> IEEE Emergency Lane Clearance</h3>
        <p>Edge-IoT system detecting emergency vehicles in bad weather and adjusting signals to clear a path.</p>
        <p><a class="project-link" onclick="openModal('IEEE lane clearance.docx','docx')"><i class="fas fa-eye"></i> View Details</a> •
           <a class="project-link" onclick="openModal('lane clearance.mp4','video')"><i class="fas fa-play"></i> View Video</a></p>
      </div>
      <div class="project-card">
        <h3><i class="fas fa-robot"></i> IEEE Shadow AI</h3>
        <p>Risk & ethics consultancy on unauthorized AI tool usage; framework for safe, responsible adoption.</p>
        <p><a class="project-link" onclick="openModal('IEEE shadow ai.docx','docx')"><i class="fas fa-eye"></i> View Details</a></p>
      </div>
      <div class="project-card">
        <h3><i class="fas fa-brain"></i> SAP Hackfest: AI-Dharma</h3>
        <p>Ethical fraud detection for banking using ML + game theory with IKS-aligned transparency.</p>
        <p><a class="project-link" onclick="openModal('SAP_HACKFEST_UPDATED.pptx','pptx')"><i class="fas fa-eye"></i> View Details</a></p>
      </div>
      <div class="project-card">
        <h3><i class="fas fa-wallet"></i> Budget Management System</h3>
        <p>Secure Spring Boot + REST app for expenses, budgets, and visual insights.</p>
        <p><a class="project-link" onclick="openModal('budget.pdf','pdf')"><i class="fas fa-eye"></i> View Details</a></p>
      </div>
    </div>
  </section>

  <!-- SKILLS -->
  <section id="skills" class="skills">
    <h2>Skills</h2>
    <div class="skills-wrap">
      <div class="skills-cloud" id="skillsCloud">
        <!-- Items are placed & animated by JS -->
      </div>
    </div>
  </section>

  <!-- CERTIFICATIONS -->
  <section id="certs" class="certs">
    <h2>Certifications</h2>
    <div class="certs-grid">
      <div class="cert-item" onclick="openModal('azure-cert.jpeg','image')">
        <i class="fab fa-microsoft"></i> Microsoft Azure Fundamentals
      </div>
      <div class="cert-item" onclick="openModal('aws-cloud.jpeg','image')">
        <i class="fab fa-aws"></i> AWS Cloud Foundations
      </div>
      <div class="cert-item" onclick="openModal('cisco cyber cert.pdf','pdf')">
        <i class="fas fa-shield-alt"></i> Cisco Introduction to Cybersecurity
      </div>
      <div class="cert-item" onclick="openModal('data analyst.jpg','image')">
        <i class="fas fa-chart-bar"></i> Data Analyst
      </div>
      <div class="cert-item" onclick="openModal('genai.jpg','image')">
        <i class="fas fa-robot"></i> GenAI Data Analyst
      </div>
      <div class="cert-item" onclick="openModal('full stack.jpg','image')">
        <i class="fas fa-layer-group"></i> Full Stack / MERN Developer
      </div>
      <div class="cert-item" onclick="openModal('azure badge.jpeg','image')">
        <i class="fab fa-microsoft"></i> Microsoft Azure AI-900 Badge
      </div>
      <div class="cert-item" onclick="openModal('innovate x cert.jpeg','image')">
        <i class="fas fa-microchip"></i> IoT InnovateX Certification
      </div>
    </div>
  </section>

  <!-- INTERNSHIPS & WORKSHOPS -->
  <section id="internships" class="internships">
    <h2>Internships & Workshops</h2>
    <div class="internships-grid">
      <div class="internship-card">
        <h3><i class="fab fa-raspberry-pi"></i> Raspberry Pi & Node.js Workshop</h3>
        <p>IIT Madras workshop building real-time IoT with Raspberry Pi and Node.js.</p>
        <p><a class="internship-link" onclick="openModal('respberry pi.jpeg','image')"><i class="fas fa-certificate"></i> View Certificate</a></p>
      </div>
      <div class="internship-card">
        <h3><i class="fas fa-chart-line"></i> Digital Marketing Intern — Maven Advert</h3>
        <p>Content, analytics, and growth across digital channels.</p>
        <p><a class="internship-link" onclick="openModal('Prem INTERN CERTIFICATE 3.pdf','pdf')"><i class="fas fa-certificate"></i> View Certificate</a></p>
      </div>
    </div>
  </section>

  <!-- ACHIEVEMENTS -->
  <section id="achievements" class="achievements">
    <h2>Achievements & Awards</h2>
    <div class="achievements-grid">
      <div class="achievement-item">
        <h3><i class="fas fa-graduation-cap"></i> Academic Recognition</h3>
        <a class="achievement-link" onclick="openModal('academic.jpg','image')"><i class="fas fa-eye"></i> View Certificate</a>
      </div>
      <div class="achievement-item">
        <h3><i class="fas fa-university"></i> College Recognition</h3>
        <a class="achievement-link" onclick="openModal('college.jpg','image')"><i class="fas fa-eye"></i> View Certificate</a>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="contact">
    <h2>Contact Me</h2>
    <p>Open to opportunities, collaborations, and conversations. Message me here:</p>
    <div class="projects-grid" style="grid-template-columns:1fr 1fr">
      <div class="project-card">
        <h3><i class="fas fa-paper-plane"></i> Send a Message</h3>
        <form action="https://formspree.io/f/mwkawnyg" method="POST">
          <input type="text" name="name" placeholder="Your Name" required>
          <input type="email" name="email" placeholder="Your Email" required>
          <textarea name="message" rows="4" placeholder="Your Message" required></textarea>
          <button type="submit" class="btn btn-view" style="margin:0"><i class="fas fa-send"></i> Send Message</button>
          <small style="color:#bbb;display:block;margin-top:8px">Your first submission may require email confirmation from Formspree.</small>
        </form>
      </div>
      <div class="project-card">
        <h3><i class="fas fa-link"></i> Connect</h3>
        <p style="display:flex;gap:18px;justify-content:center;flex-wrap:wrap">
          <a href="https://www.linkedin.com/in/prem-s-12626b309/" target="_blank" class="btn"><i class="fab fa-linkedin"></i> LinkedIn</a>
          <a href="https://github.com/kingprem12" target="_blank" class="btn"><i class="fab fa-github"></i> GitHub</a>
          <a href="https://canary.discord.com/channels/@me/948821325370253343" target="_blank" class="btn"><i class="fab fa-discord"></i> Discord</a>
        </p>
        <p><i class="fas fa-envelope"></i> Email: <a href="mailto:selvaraj3805@gmail.com" style="color:#0ff">selvaraj3805@gmail.com</a></p>
        <p><i class="fas fa-phone"></i> Phone: <a href="tel:+918778642535" style="color:#0ff">+91 8778642535</a></p>
      </div>
    </div>
  </section>

  <!-- RESUME -->
  <section id="resume" class="resume">
    <h2>My Resume</h2>
    <p>Preview below or use the buttons at the top to view/download.</p>
    <iframe src="kisame.pdf"></iframe>
  </section>

  <!-- MODAL -->
  <div id="fileModal" class="modal" onclick="closeModal()">
    <span class="close" aria-label="close">&times;</span>
    <div class="modal-content-container">
      <img class="modal-content" id="modalImg" style="display:none;">
      <iframe id="modalIframe" style="display:none;"></iframe>
      <video id="modalVideo" controls playsinline webkit-playsinline style="display:none;"></video>
    </div>
  </div>

  <script>
    /* -------- Enhanced Dramatic Cursor Smoke and Glitter Effects -------- */
    const cursorCanvas = document.getElementById('cursorCanvas');
    const cCtx = cursorCanvas.getContext('2d');
    
    function sizeCursor() {
      cursorCanvas.width = window.innerWidth;
      cursorCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', sizeCursor);
    sizeCursor();

    let smokeParticles = [];
    let glitterParticles = [];
    let mouseX = 0, mouseY = 0;
    let lastMouseX = 0, lastMouseY = 0;

    class EnhancedSmokeParticle {
      constructor(x, y, velocity = 1) {
        this.x = x + (Math.random() - 0.5) * 15;
        this.y = y + (Math.random() - 0.5) * 15;
        this.vx = (Math.random() - 0.5) * 3 * velocity;
        this.vy = (Math.random() - 0.5) * 3 * velocity - 1;
        this.life = 120 + Math.random() * 60;
        this.maxLife = this.life;
        this.size = Math.random() * 6 + 2;
        this.hue = 180 + Math.random() * 60;
        this.expansion = Math.random() * 0.03 + 0.02;
        this.opacity = 0.9;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy -= 0.02; // upward drift
        this.vx *= 0.98; // air resistance
        this.vy *= 0.98;
        this.size += this.expansion;
        this.life--;
        this.opacity = (this.life / this.maxLife) * 0.9;
        
        // Add turbulence
        this.vx += (Math.random() - 0.5) * 0.2;
        this.vy += (Math.random() - 0.5) * 0.2;
      }

      draw() {
        const gradient = cCtx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
        gradient.addColorStop(0, `hsla(${this.hue}, 100%, 70%, ${this.opacity})`);
        gradient.addColorStop(0.4, `hsla(${this.hue}, 100%, 60%, ${this.opacity * 0.6})`);
        gradient.addColorStop(1, `hsla(${this.hue}, 100%, 50%, 0)`);
        
        cCtx.save();
        cCtx.globalCompositeOperation = 'screen';
        cCtx.beginPath();
        cCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        cCtx.fillStyle = gradient;
        cCtx.fill();
        cCtx.restore();
      }

      isDead() {
        return this.life <= 0;
      }
    }

    class GlitterParticle {
      constructor(x, y) {
        this.x = x + (Math.random() - 0.5) * 20;
        this.y = y + (Math.random() - 0.5) * 20;
        this.vx = (Math.random() - 0.5) * 4;
        this.vy = (Math.random() - 0.5) * 4;
        this.life = 80 + Math.random() * 40;
        this.maxLife = this.life;
        this.size = Math.random() * 3 + 1;
        this.rotation = Math.random() * Math.PI * 2;
        this.rotationSpeed = (Math.random() - 0.5) * 0.3;
        this.sparkle = Math.random() * Math.PI * 2;
        this.colors = [
          { r: 0, g: 255, b: 255 },     // cyan
          { r: 255, g: 255, b: 255 },   // white
          { r: 142, g: 45, b: 226 },    // purple
          { r: 255, g: 215, b: 0 }      // gold
        ];
        this.color = this.colors[Math.floor(Math.random() * this.colors.length)];
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vx *= 0.95;
        this.vy *= 0.95;
        this.vy += 0.1; // gravity
        this.rotation += this.rotationSpeed;
        this.sparkle += 0.2;
        this.life--;
      }

      draw() {
        const alpha = (this.life / this.maxLife);
        const sparkleIntensity = Math.abs(Math.sin(this.sparkle));
        
        cCtx.save();
        cCtx.translate(this.x, this.y);
        cCtx.rotate(this.rotation);
        cCtx.globalCompositeOperation = 'screen';
        
        // Draw star shape
        cCtx.beginPath();
        for (let i = 0; i < 4; i++) {
          const angle = (i * Math.PI) / 2;
          const x = Math.cos(angle) * this.size * sparkleIntensity;
          const y = Math.sin(angle) * this.size * sparkleIntensity;
          if (i === 0) cCtx.moveTo(x, y);
          else cCtx.lineTo(x, y);
        }
        
        cCtx.fillStyle = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${alpha})`;
        cCtx.fill();
        
        // Add glow
        cCtx.shadowBlur = 20;
        cCtx.shadowColor = `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${alpha})`;
        cCtx.fill();
        
        cCtx.restore();
      }

      isDead() {
        return this.life <= 0;
      }
    }

    window.addEventListener('mousemove', (e) => {
      const prevMouseX = mouseX;
      const prevMouseY = mouseY;
      mouseX = e.clientX;
      mouseY = e.clientY;
      
      // Calculate mouse velocity for more dramatic effects
      const dx = mouseX - prevMouseX;
      const dy = mouseY - prevMouseY;
      const velocity = Math.sqrt(dx * dx + dy * dy) / 10;
      
      // Create enhanced smoke particles
      const particleCount = Math.min(8 + Math.floor(velocity * 2), 15);
      for (let i = 0; i < particleCount; i++) {
        smokeParticles.push(new EnhancedSmokeParticle(mouseX, mouseY, velocity));
      }
      
      // Create glitter particles on fast movement
      if (velocity > 2) {
        for (let i = 0; i < Math.floor(velocity); i++) {
          glitterParticles.push(new GlitterParticle(mouseX, mouseY));
        }
      }
      
      lastMouseX = mouseX;
      lastMouseY = mouseY;
    });

    function animateEnhancedCursor() {
      cCtx.clearRect(0, 0, cursorCanvas.width, cursorCanvas.height);
      
      // Update and draw smoke particles
      smokeParticles = smokeParticles.filter(particle => {
        particle.update();
        particle.draw();
        return !particle.isDead();
      });
      
      // Update and draw glitter particles
      glitterParticles = glitterParticles.filter(particle => {
        particle.update();
        particle.draw();
        return !particle.isDead();
      });

      requestAnimationFrame(animateEnhancedCursor);
    }
    animateEnhancedCursor();

    /* -------- Three.js 3D Background Scene -------- */
    let scene, camera, renderer, particles, geometries = [];

    function initThreeJS() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x000000, 0);
      
      const container = document.getElementById('threeCanvas');
      container.appendChild(renderer.domElement);

      // Create floating geometric shapes
      const shapes = [
        new THREE.BoxGeometry(1, 1, 1),
        new THREE.SphereGeometry(0.5, 8, 6),
        new THREE.ConeGeometry(0.5, 1, 8),
        new THREE.OctahedronGeometry(0.7),
        new THREE.TetrahedronGeometry(0.8)
      ];

      for (let i = 0; i < 15; i++) {
        const geometry = shapes[Math.floor(Math.random() * shapes.length)];
        const material = new THREE.MeshPhongMaterial({
          color: new THREE.Color().setHSL(0.5 + Math.random() * 0.2, 0.8, 0.6),
          transparent: true,
          opacity: 0.3,
          wireframe: Math.random() > 0.5
        });
        
        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(
          (Math.random() - 0.5) * 100,
          (Math.random() - 0.5) * 100,
          (Math.random() - 0.5) * 100
        );
        mesh.rotation.set(
          Math.random() * Math.PI,
          Math.random() * Math.PI,
          Math.random() * Math.PI
        );
        
        mesh.userData = {
          rotationSpeed: {
            x: (Math.random() - 0.5) * 0.02,
            y: (Math.random() - 0.5) * 0.02,
            z: (Math.random() - 0.5) * 0.02
          },
          floatSpeed: Math.random() * 0.01 + 0.005
        };
        
        scene.add(mesh);
        geometries.push(mesh);
      }

      // Enhanced particle system
      const particleGeometry = new THREE.BufferGeometry();
      const particleCount = 1500;
      const positions = new Float32Array(particleCount * 3);
      
      for (let i = 0; i < particleCount * 3; i++) {
        positions[i] = (Math.random() - 0.5) * 200;
      }
      
      particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      
      const particleMaterial = new THREE.PointsMaterial({
        color: 0x00ffff,
        size: 0.8,
        transparent: true,
        opacity: 0.7
      });
      
      particles = new THREE.Points(particleGeometry, particleMaterial);
      scene.add(particles);

      // Enhanced lighting
      const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
      scene.add(ambientLight);
      
      const pointLight1 = new THREE.PointLight(0x00ffff, 1.2, 100);
      pointLight1.position.set(10, 10, 10);
      scene.add(pointLight1);
      
      const pointLight2 = new THREE.PointLight(0x8e2de2, 1, 100);
      pointLight2.position.set(-10, -10, 10);
      scene.add(pointLight2);

      camera.position.z = 30;

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      animateThree();
    }

    function animateThree() {
      requestAnimationFrame(animateThree);

      geometries.forEach((mesh, index) => {
        mesh.rotation.x += mesh.userData.rotationSpeed.x;
        mesh.rotation.y += mesh.userData.rotationSpeed.y;
        mesh.rotation.z += mesh.userData.rotationSpeed.z;
        mesh.position.y += Math.sin(Date.now() * mesh.userData.floatSpeed + index) * 0.1;
      });

      if (particles) {
        particles.rotation.y += 0.001;
        particles.rotation.x += 0.0005;
      }

      camera.position.x = Math.sin(Date.now() * 0.0005) * 5;
      camera.position.y = Math.cos(Date.now() * 0.0003) * 3;
      camera.lookAt(scene.position);

      renderer.render(scene, camera);
    }

    window.addEventListener('load', initThreeJS);

    /* -------- Enhanced Background -------- */
    const bgCanvas = document.getElementById('backgroundCanvas');
    const bCtx = bgCanvas.getContext('2d');
    
    function sizeBg() {
      bgCanvas.width = window.innerWidth;
      bgCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', sizeBg);
    sizeBg();

    let networkDots = [];
    const DOTS = 150;
    const MAX_DISTANCE = 180;

    class NetworkDot {
      constructor() {
        this.x = Math.random() * bgCanvas.width;
        this.y = Math.random() * bgCanvas.height;
        this.vx = (Math.random() - 0.5) * 1;
        this.vy = (Math.random() - 0.5) * 1;
        this.r = Math.random() * 2.5 + 0.5;
        this.hue = 180 + Math.random() * 80;
        this.pulse = Math.random() * Math.PI * 2;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        
        if (this.x < 0 || this.x > bgCanvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > bgCanvas.height) this.vy *= -1;
        
        this.pulse += 0.03;
      }

      draw() {
        const pulseSize = this.r + Math.sin(this.pulse) * 0.8;
        const alpha = 0.9 + Math.sin(this.pulse) * 0.4;
        
        bCtx.beginPath();
        bCtx.arc(this.x, this.y, pulseSize, 0, Math.PI * 2);
        bCtx.fillStyle = `hsla(${this.hue}, 100%, 75%, ${alpha})`;
        bCtx.fill();
        
        bCtx.beginPath();
        bCtx.arc(this.x, this.y, pulseSize * 2.5, 0, Math.PI * 2);
        bCtx.fillStyle = `hsla(${this.hue}, 100%, 75%, ${alpha * 0.15})`;
        bCtx.fill();
      }
    }

    function initNetworkDots() {
      networkDots = [];
      for (let i = 0; i < DOTS; i++) {
        networkDots.push(new NetworkDot());
      }
    }
    initNetworkDots();

    function animateBackground() {
      bCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
      
      const time = Date.now() * 0.001;
      const gradient = bCtx.createRadialGradient(
        bgCanvas.width/2 + Math.sin(time) * 150,
        bgCanvas.height/2 + Math.cos(time) * 150,
        0,
        bgCanvas.width/2,
        bgCanvas.height/2,
        Math.max(bgCanvas.width, bgCanvas.height) / 1.2
      );
      gradient.addColorStop(0, `hsla(${190 + Math.sin(time) * 30}, 100%, 15%, 0.5)`);
      gradient.addColorStop(0.5, `hsla(${250 + Math.cos(time) * 40}, 100%, 8%, 0.3)`);
      gradient.addColorStop(1, 'rgba(0,0,0,0)');
      
      bCtx.fillStyle = gradient;
      bCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);

      networkDots.forEach(dot => {
        dot.update();
        dot.draw();
      });

      for (let i = 0; i < networkDots.length; i++) {
        for (let j = i + 1; j < networkDots.length; j++) {
          const dx = networkDots[i].x - networkDots[j].x;
          const dy = networkDots[i].y - networkDots[j].y;
          const distance = Math.hypot(dx, dy);
          
          if (distance < MAX_DISTANCE) {
            const alpha = (1 - distance / MAX_DISTANCE) * 0.7;
            bCtx.beginPath();
            bCtx.moveTo(networkDots[i].x, networkDots[i].y);
            bCtx.lineTo(networkDots[j].x, networkDots[j].y);
            bCtx.strokeStyle = `rgba(0, 255, 255, ${alpha})`;
            bCtx.lineWidth = 0.8;
            bCtx.stroke();
          }
        }
      }

      requestAnimationFrame(animateBackground);
    }
    animateBackground();

    /* -------- Floating particles -------- */
    function createFloatingParticles() {
      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        particle.className = 'floating-particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (12 + Math.random() * 8) + 's';
        document.body.appendChild(particle);
      }
    }
    createFloatingParticles();

    /* -------- Enhanced 3D tilt on cards -------- */
    document.querySelectorAll('.project-card, .internship-card, .achievement-item').forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;
        
        const rotateX = (y / rect.height) * -20;
        const rotateY = (x / rect.width) * 20;
        
        card.style.transform = `
          perspective(1200px) 
          rotateX(${rotateX}deg) 
          rotateY(${rotateY}deg) 
          translateY(-12px) 
          scale(1.03)
        `;
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = '';
      });
    });

    /* -------- Fixed and Enhanced Skills Cloud (Properly Centered) -------- */
    const skillsData = [
      {label:'C++', desc:'Proficient in C++ for competitive programming and system-level applications with advanced data structures.'},
      {label:'Java', desc:'Robust backend services with Spring Boot, microservices architecture, and enterprise-level solutions.'},
      {label:'JavaScript', desc:'Modern ES6+ JavaScript for dynamic, interactive web experiences and real-time applications.'},
      {label:'React', desc:'Responsive, modern UI development with React.js, hooks, and state management libraries.'},
      {label:'Node.js', desc:'Scalable server-side APIs, real-time applications, and microservices with Express.js.'},
      {label:'Express', desc:'Efficient RESTful APIs, middleware implementation, and backend architecture with Express.js.'},
      {label:'MySQL', desc:'Advanced database design, query optimization, indexing, and relational schema architecture.'},
      {label:'AWS', desc:'Cloud infrastructure with EC2, S3, Lambda, RDS, and comprehensive deployment strategies.'},
      {label:'Spring Boot', desc:'Production-grade microservices, security implementation, and enterprise Java applications.'},
      {label:'Python', desc:'Data analysis, machine learning, automation scripts, and AI model development.'},
      {label:'UI/UX Design', desc:'Human-centered design principles, wireframing, prototyping, and responsive design systems.'}
    ];

    const cloud = document.getElementById('skillsCloud');
    const radius = 200;
    const items = [];

    skillsData.forEach((skill, i) => {
      const el = document.createElement('div');
      el.className = 'skill';
      el.innerHTML = `<span class="label">${skill.label}</span><div class="desc">${skill.desc}</div>`;
      cloud.appendChild(el);
      items.push(el);
    });

    // Position items in 3D sphere (properly centered)
    const N = items.length;
    items.forEach((el, i) => {
      const phi = Math.acos(1 - 2 * (i + 0.5) / N);
      const theta = Math.PI * (1 + Math.sqrt(5)) * (i + 0.5);
      const x = radius * Math.sin(phi) * Math.cos(theta);
      const y = radius * Math.sin(phi) * Math.sin(theta);
      const z = radius * Math.cos(phi);
      el.dataset.x = x;
      el.dataset.y = y;
      el.dataset.z = z;
    });

    let rotY = 0, rotX = 0;
    function renderSkillsCloud() {
      const sinY = Math.sin(rotY), cosY = Math.cos(rotY);
      const sinX = Math.sin(rotX), cosX = Math.cos(rotX);
      
      items.forEach(el => {
        let x = +el.dataset.x, y = +el.dataset.y, z = +el.dataset.z;
        
        // 3D rotation
        let x1 = x * cosY + z * sinY;
        let z1 = -x * sinY + z * cosY;
        let y1 = y * cosX - z1 * sinX;
        let z2 = y * sinX + z1 * cosX;

        const scale = 0.7 + (z2 / (radius * 2)) * 0.5;
        const opacity = 0.5 + (z2 / (radius * 2)) * 0.5;
        
        // Center the element properly
        el.style.transform = `translate(-50%, -50%) translate3d(${x1}px, ${y1}px, ${z2}px) scale(${scale})`;
        el.style.zIndex = Math.floor(1000 + z2);
        el.style.opacity = opacity;
      });
      
      rotY += 0.004;
      requestAnimationFrame(renderSkillsCloud);
    }
    renderSkillsCloud();

    // Enhanced parallax
    const skillsWrap = document.querySelector('.skills-wrap');
    skillsWrap.addEventListener('mousemove', (e) => {
      const rect = skillsWrap.getBoundingClientRect();
      const px = (e.clientX - rect.left) / rect.width - 0.5;
      const py = (e.clientY - rect.top) / rect.height - 0.5;
      rotY += px * 0.02;
      rotX += -py * 0.02;
    });

    // Click to pin
    items.forEach(el => {
      el.addEventListener('click', (e) => {
        e.stopPropagation();
        items.forEach(item => item.classList.remove('pinned'));
        el.classList.add('pinned');
      });
    });
    
    document.addEventListener('click', () => {
      items.forEach(item => item.classList.remove('pinned'));
    });

    /* -------- Modal functionality -------- */
    function openModal(src, type) {
      const modal = document.getElementById('fileModal');
      const img = document.getElementById('modalImg');
      const iframe = document.getElementById('modalIframe');
      const video = document.getElementById('modalVideo');
      
      img.style.display = 'none';
      iframe.style.display = 'none';
      video.style.display = 'none';
      video.pause();
      video.currentTime = 0;

      const fileType = (type || '').toLowerCase();
      
      if (fileType === 'image' || /\.(png|jpe?g|gif|webp)$/i.test(src)) {
        img.src = src;
        img.style.display = 'block';
      } else if (fileType === 'video' || /\.(mp4|webm|ogg)$/i.test(src)) {
        video.src = src;
        video.style.display = 'block';
      } else {
        iframe.src = src;
        iframe.style.display = 'block';
      }

      modal.style.display = 'flex';
    }

    function closeModal() {
      const modal = document.getElementById('fileModal');
      const iframe = document.getElementById('modalIframe');
      const video = document.getElementById('modalVideo');
      
      modal.style.display = 'none';
      iframe.src = '';
      video.pause();
      video.currentTime = 0;
      video.src = '';
    }

    window.openModal = openModal;
    window.closeModal = closeModal;

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
  </script>
</body>
</html>
